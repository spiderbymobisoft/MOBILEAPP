{"version":3,"sources":["../../src/pages/new-entity/new-entity.module.ts","../../src/pages/new-entity/new-entity.ts"],"names":[],"mappings":"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","file":"25.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { NewEntityPage } from './new-entity';\n\n@NgModule({\n  declarations: [\n    NewEntityPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(NewEntityPage),\n  ],\n})\nexport class NewEntityPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/new-entity/new-entity.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams } from 'ionic-angular';\nimport { Geolocation } from '@ionic-native/geolocation';\nimport { Store } from '../../app.services/store/data.store';\nimport { SharedServices } from '../../app.services/library/shared.services';\nimport { FormConfig } from '../../app.services/store/form.config';\n\n@IonicPage()\n@Component({\n  selector: 'page-new-entity',\n  templateUrl: 'new-entity.html',\n})\nexport class NewEntityPage {\n  public payload: any = {\n    record_id: '',\n    document_owner: '',\n    building_serial_number: '',\n    property_id: '',\n    entity: {\n      entity_id: '',\n      entity_name: '',\n      entity_group: '',\n      entity_category: '',\n      entity_categories: [],\n      meter_available: false,\n      meter_condition: '',\n      meter_phases: '',\n      meter_type: '',\n      meter_number: '',\n      has_signage: false,\n      entity_detail: {}\n    },\n    contact: {\n      contact_person: '',\n      email: '',\n      telephone: ''\n    },\n    location: {\n      type: 'Point',\n      coordinates: {\n        latitude: 0,\n        longitude: 0\n      },\n      whatthreewords: ''\n    },\n    property_photos: [],\n    enumerator: {\n      id: '',\n      firstname: '',\n      lastname: '',\n      email: '',\n      telephone: ''\n    },\n    signature: ''\n  };\n\n  public entityGroup: any[] = [];\n\n  private user: any;\n  constructor(public navCtrl: NavController, public navParams: NavParams, public formConfig: FormConfig,\n    private store: Store, private ss: SharedServices, private geolocation: Geolocation) {\n    this.dataInit();\n  }\n\n  dataInit() {\n    this.payload.property_id = this.navParams.get('propertyId');\n    this.payload.building_serial_number = this.navParams.get('BSN');\n    this.payload.record_id = this.ss.GENERATE_RECORD_ID();\n    this.store.GET_USER().then(data=>{\n      this.user = data;\n    });\n  }\n\n  ionViewDidLoad() {\n\n  }\n\n  loadCategory(value) {\n    this.entityGroup = this.formConfig.entityGroup.filter(data => data.title === value)[0]['sub_titles'];\n  }\n\n  isFormValid(): boolean {\n    if(!this.payload.entity.entity_name || \n      !this.payload.entity.entity_group || \n      this.payload.entity.entity_categories.length === 0 ||\n      !this.payload.entity.meter_condition ||\n      !this.payload.entity.meter_phases ||\n      this.payload.entity.meter_type.length === 0 ||\n      !this.payload.entity.meter_number\n    ){\n      return false\n    }else{\n      return true\n    }\n  }\n\n  save() {\n    if (!this.isFormValid()) {\n      this.ss.swalAlert('Data Service', 'All fields are required. Please try again', 'error');\n    } else {\n      this.processSave();\n    }\n\n  }\n\n  processSave() {\n    this.ss.presentLoading();\n    this.payload.signature = this.ss.GENERATE_SIGNATURE;\n    this.payload.document_owner = this.user.document_owner ? this.user.document_owner : this.user._id;\n    this.payload.enumerator = {\n      id: this.user._id,\n      firstname: this.user.personal.firstname,\n      lastname: this.user.personal.lastname,\n      email: this.user.personal.email,\n      mobile: this.user.personal.mobile\n    };\n    this.payload.entity.entity_id = this.ss.GENERATE_ENTITY_ID();\n    this.geolocation.getCurrentPosition({ timeout: 30000, enableHighAccuracy: true }).then((position) => {\n      this.ss.toast('Location captured', 2000);\n      this.payload.location.coordinates = { latitude: position.coords.latitude, longitude: position.coords.longitude };\n        this.store.UPDATE_RECORD('__entities__',this.payload).then(feedback => {\n          if (feedback) {\n            this.ss.dismissLoading();\n            this.ss.swalAlert('Data Service', 'Record stored successfully. <br><b>Next</b>: Add entity photo', 'success');\n            this.navCtrl.pop().then(() => {\n              this.navCtrl.push('EntityPhotoPage', { \n                property: this.payload.property_id, \n                entity: this.payload.entity.entity_id,\n                BSN: this.payload.building_serial_number\n              }); \n            });\n          } else {\n            this.ss.dismissLoading();\n            this.ss.swalAlert('Data Service', 'Storage error! Please try again.', 'error');\n          }\n        }).catch(err => {\n          this.ss.dismissLoading();\n          this.ss.swalAlert('Data Service', 'Storage error! Please try again.', 'error');\n        });\n    }).catch(err => {\n      this.ss.dismissLoading();\n      this.ss.toast('Unable to capture device current location. Pleas turn on device location access', 3000);\n    });\n  }\n\n\n}\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/new-entity/new-entity.ts"],"sourceRoot":""}